generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                String  @id
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  User              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId, provider])
}

model Session {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Store {
  id        String   @id
  name      String
  slug      String   @unique
  ownerId   String
  isActive  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
}

model User {
  id                                 String            @id
  name                               String?
  email                              String?           @unique
  emailVerified                      DateTime?
  image                              String?
  role                               UserRole          @default(USER)
  createdAt                          DateTime          @default(now())
  updatedAt                          DateTime          @default(now())
  password                           String?
  Account                            Account[]
  Session                            Session[]
  article_likes                      article_likes[]
  articles_articles_authorIdToUser   articles[]        @relation("articles_authorIdToUser")
  articles_articles_reviewedByToUser articles[]        @relation("articles_reviewedByToUser")
  comment_flags                      comment_flags[]
  comments_comments_deletedByToUser  comments[]        @relation("comments_deletedByToUser")
  comments_comments_userIdToUser     comments[]        @relation("comments_userIdToUser")
  media                              media[]
  product_reviews                    product_reviews[]
  store_orders                       store_orders[]
  tenants                            tenants[]
  vendor_stores                      vendor_stores[]
  writer_profiles                    writer_profiles?

  @@index([email])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model article_likes {
  id        String   @id
  articleId String
  userId    String
  createdAt DateTime @default(now())
  articles  articles @relation(fields: [articleId], references: [id], onDelete: Cascade)
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([articleId, userId])
  @@index([articleId])
  @@index([userId])
}

model articles {
  id                             String          @id
  authorId                       String
  authorName                     String
  authorPhoto                    String?
  authorBio                      String?
  title                          String
  slug                           String          @unique
  subtitle                       String?
  excerpt                        String?
  content                        String
  metaTitle                      String?         @db.VarChar(60)
  metaDescription                String?         @db.VarChar(160)
  status                         ArticleStatus   @default(DRAFT)
  category                       ArticleCategory
  subCategory                    String?
  tags                           String[]
  featuredImageUrl               String?
  featuredImageAlt               String?
  featuredImageCaption           String?
  contentBlocks                  Json?
  readingTime                    Int?
  reviewedBy                     String?
  reviewNotes                    String?
  publishedAt                    DateTime?
  isFeatured                     Boolean         @default(false)
  featuredUntil                  DateTime?
  viewCount                      Int             @default(0)
  likeCount                      Int             @default(0)
  shareCount                     Int             @default(0)
  createdAt                      DateTime        @default(now())
  updatedAt                      DateTime        @default(now())
  article_likes                  article_likes[]
  User_articles_authorIdToUser   User            @relation("articles_authorIdToUser", fields: [authorId], references: [id], onDelete: Cascade)
  User_articles_reviewedByToUser User?           @relation("articles_reviewedByToUser", fields: [reviewedBy], references: [id])
  comments                       comments[]

  @@index([authorId])
  @@index([category])
  @@index([publishedAt])
  @@index([reviewedBy])
  @@index([status])
}

model categories {
  id          String   @id
  name        String   @unique
  slug        String   @unique
  description String?
  color       String?
  createdAt   DateTime @default(now())
}

model comment_flags {
  id        String   @id
  commentId String
  userId    String
  reason    String
  details   String?
  createdAt DateTime @default(now())
  comments  comments @relation(fields: [commentId], references: [id], onDelete: Cascade)
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([commentId, userId])
  @@index([commentId])
  @@index([userId])
}

model comments {
  id                            String          @id
  articleId                     String
  userId                        String
  userName                      String
  userPhoto                     String?
  content                       String
  parentId                      String?
  isApproved                    Boolean         @default(true)
  isFlagged                     Boolean         @default(false)
  createdAt                     DateTime        @default(now())
  updatedAt                     DateTime        @default(now())
  deletedAt                     DateTime?
  deletedBy                     String?
  flagCount                     Int             @default(0)
  comment_flags                 comment_flags[]
  articles                      articles        @relation(fields: [articleId], references: [id], onDelete: Cascade)
  User_comments_deletedByToUser User?           @relation("comments_deletedByToUser", fields: [deletedBy], references: [id])
  comments                      comments?       @relation("commentsTocomments", fields: [parentId], references: [id], onDelete: Cascade)
  other_comments                comments[]      @relation("commentsTocomments")
  User_comments_userIdToUser    User            @relation("comments_userIdToUser", fields: [userId], references: [id], onDelete: Cascade)

  @@index([articleId])
  @@index([deletedAt])
  @@index([isFlagged])
  @@index([userId])
}

model coupons {
  id                     String         @id
  vendorStoreId          String
  code                   String
  description            String?
  discountType           DiscountType
  discountValue          Decimal        @db.Decimal(10, 2)
  minPurchaseAmount      Decimal?       @db.Decimal(10, 2)
  maxDiscountAmount      Decimal?       @db.Decimal(10, 2)
  usageLimit             Int?
  usageCount             Int            @default(0)
  perCustomerLimit       Int?
  startDate              DateTime?
  endDate                DateTime?
  isActive               Boolean        @default(true)
  applicableProducts     String[]
  applicableCategories   String[]
  excludedProducts       String[]
  firstTimeCustomersOnly Boolean        @default(false)
  createdAt              DateTime       @default(now())
  updatedAt              DateTime       @default(now())
  vendor_stores          vendor_stores  @relation(fields: [vendorStoreId], references: [id], onDelete: Cascade)
  store_orders           store_orders[]

  @@unique([vendorStoreId, code])
  @@index([code])
  @@index([endDate])
  @@index([vendorStoreId, isActive])
}

model media {
  id           String   @id
  filename     String
  originalName String
  url          String
  mimeType     String
  size         Int
  width        Int?
  height       Int?
  alt          String?
  caption      String?
  credit       String?
  bucketKey    String
  uploadedById String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @default(now())
  User         User     @relation(fields: [uploadedById], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([mimeType])
  @@index([uploadedById])
}

model product_addons {
  id                  String    @id
  productId           String?
  storeId             String
  name                String
  description         String?
  price               Decimal   @db.Decimal(10, 2)
  isRequired          Boolean   @default(false)
  allowMultiple       Boolean   @default(false)
  maxQuantity         Int?
  requiredForVariants Json?
  excludedForVariants Json?
  imageUrl            String?
  icon                String?
  sortOrder           Int       @default(0)
  isActive            Boolean   @default(true)
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @default(now())
  products            products? @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId, isActive])
  @@index([storeId, isActive])
}

model product_images {
  id        String   @id
  productId String
  url       String
  thumbnail String?
  medium    String?
  large     String?
  altText   String?
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  products  products @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
}

model product_reviews {
  id                 String            @id
  productId          String
  orderItemId        String            @unique
  customerId         String?
  vendorStoreId      String
  rating             Int
  title              String?           @db.VarChar(100)
  review             String
  photoUrls          String[]
  isVerifiedPurchase Boolean           @default(true)
  customerName       String
  customerEmail      String
  vendorResponse     String?
  vendorRespondedAt  DateTime?
  status             ReviewStatus      @default(PUBLISHED)
  flaggedAt          DateTime?
  flagReason         String?
  helpfulCount       Int               @default(0)
  unhelpfulCount     Int               @default(0)
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @default(now())
  User               User?             @relation(fields: [customerId], references: [id])
  store_order_items  store_order_items @relation(fields: [orderItemId], references: [id], onDelete: Cascade)
  products           products          @relation(fields: [productId], references: [id], onDelete: Cascade)
  vendor_stores      vendor_stores     @relation(fields: [vendorStoreId], references: [id], onDelete: Cascade)

  @@index([customerId])
  @@index([orderItemId])
  @@index([productId, status, createdAt])
  @@index([vendorStoreId, createdAt])
}

model product_variants {
  id        String   @id
  productId String
  name      String
  value     String
  price     Decimal? @db.Decimal(10, 2)
  sku       String?
  quantity  Int      @default(0)
  imageUrl  String?
  available Boolean  @default(true)
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
  products  products @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId, available])
  @@index([productId])
}

model products {
  id                   String                 @id
  vendorStoreId        String
  name                 String
  slug                 String
  description          String
  price                Decimal                @db.Decimal(10, 2)
  compareAtPrice       Decimal?               @db.Decimal(10, 2)
  sku                  String?
  quantity             Int                    @default(0)
  trackInventory       Boolean                @default(true)
  lowStockThreshold    Int                    @default(5)
  category             ProductCategory
  subcategory          String?
  tags                 String[]
  hasVariants          Boolean                @default(false)
  variantType          VariantType?
  weight               Decimal?               @db.Decimal(8, 2)
  requiresShipping     Boolean                @default(true)
  metaTitle            String?                @db.VarChar(60)
  metaDescription      String?                @db.VarChar(160)
  status               ProductStatus          @default(DRAFT)
  publishedAt          DateTime?
  viewCount            Int                    @default(0)
  salesCount           Int                    @default(0)
  averageRating        Decimal?               @db.Decimal(3, 2)
  reviewCount          Int                    @default(0)
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @default(now())
  variantTypes         String[]               @default([])
  useMultiVariants     Boolean                @default(false)
  product_addons       product_addons[]
  product_images       product_images[]
  product_reviews      product_reviews[]
  product_variants     product_variants[]
  vendor_stores        vendor_stores          @relation(fields: [vendorStoreId], references: [id], onDelete: Cascade)
  store_order_items    store_order_items[]
  variant_combinations variant_combinations[]
  variant_options      variant_options[]

  @@unique([vendorStoreId, slug])
  @@index([category])
  @@index([category, status])
  @@index([status])
  @@index([useMultiVariants])
  @@index([vendorStoreId, status])
}

model shop_ratings {
  id             String        @id
  vendorStoreId  String        @unique
  averageRating  Decimal       @db.Decimal(3, 2)
  totalReviews   Int           @default(0)
  fiveStars      Int           @default(0)
  fourStars      Int           @default(0)
  threeStars     Int           @default(0)
  twoStars       Int           @default(0)
  oneStar        Int           @default(0)
  lastCalculated DateTime      @default(now())
  updatedAt      DateTime      @default(now())
  vendor_stores  vendor_stores @relation(fields: [vendorStoreId], references: [id], onDelete: Cascade)
}

model store_order_items {
  id                   String           @id
  storeOrderId         String
  productId            String
  variantId            String?
  name                 String
  sku                  String?
  price                Decimal          @db.Decimal(10, 2)
  quantity             Int
  variantName          String?
  imageUrl             String?
  createdAt            DateTime         @default(now())
  addons               Json?
  variantCombinationId String?
  variantDetails       Json?
  product_reviews      product_reviews?
  products             products         @relation(fields: [productId], references: [id])
  store_orders         store_orders     @relation(fields: [storeOrderId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([storeOrderId])
}

model store_orders {
  id                String                   @id
  orderNumber       String                   @unique
  vendorStoreId     String
  customerId        String?
  customerEmail     String
  customerName      String
  customerPhone     String?
  shippingAddress   Json
  billingAddress    Json
  subtotal          Decimal                  @db.Decimal(10, 2)
  shippingCost      Decimal                  @db.Decimal(10, 2)
  taxAmount         Decimal                  @db.Decimal(10, 2)
  discountAmount    Decimal                  @default(0) @db.Decimal(10, 2)
  total             Decimal                  @db.Decimal(10, 2)
  platformFee       Decimal                  @db.Decimal(10, 2)
  vendorPayout      Decimal                  @db.Decimal(10, 2)
  paymentProcessor  PaymentProcessor         @default(STRIPE)
  paymentIntentId   String?                  @unique
  paymentStatus     MarketplacePaymentStatus @default(PENDING)
  paidAt            DateTime?
  fulfillmentStatus FulfillmentStatus        @default(UNFULFILLED)
  shippingMethod    String?
  trackingNumber    String?
  carrier           String?
  shippedAt         DateTime?
  deliveredAt       DateTime?
  status            MarketplaceOrderStatus   @default(PENDING)
  customerNotes     String?
  internalNotes     String?
  cancelledAt       DateTime?
  cancelReason      String?
  refundedAt        DateTime?
  refundAmount      Decimal?                 @db.Decimal(10, 2)
  createdAt         DateTime                 @default(now())
  updatedAt         DateTime                 @default(now())
  couponCode        String?
  couponId          String?
  store_order_items store_order_items[]
  coupons           coupons?                 @relation(fields: [couponId], references: [id])
  User              User?                    @relation(fields: [customerId], references: [id])
  vendor_stores     vendor_stores            @relation(fields: [vendorStoreId], references: [id])

  @@index([couponId])
  @@index([createdAt])
  @@index([customerEmail])
  @@index([customerId])
  @@index([fulfillmentStatus])
  @@index([paymentStatus])
  @@index([status])
  @@index([vendorStoreId, createdAt])
  @@index([vendorStoreId, status, createdAt])
}

model subscription_history {
  id                 String           @id
  tenantId           String
  plan               SubscriptionPlan
  amount             Decimal          @db.Decimal(10, 2)
  stripePriceId      String
  stripeInvoiceId    String?
  status             String
  billingPeriodStart DateTime
  billingPeriodEnd   DateTime
  createdAt          DateTime         @default(now())
  tenants            tenants          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, createdAt])
}

model tenants {
  id                    String                 @id
  name                  String
  slug                  String                 @unique
  ownerId               String
  subscriptionPlan      SubscriptionPlan       @default(TRIAL)
  subscriptionStatus    SubscriptionStatus     @default(TRIAL)
  stripeCustomerId      String?                @unique
  stripeSubscriptionId  String?                @unique
  stripePriceId         String?
  currentPeriodEnd      DateTime?
  customDomain          String?                @unique
  customDomainVerified  Boolean                @default(false)
  customDomainStatus    DomainStatus           @default(PENDING)
  customDomainDnsRecord String?
  sslCertificateStatus  SSLStatus              @default(PENDING)
  sslCertificateExpiry  DateTime?
  sslLastCheckedAt      DateTime?
  maxProducts           Int                    @default(10)
  maxOrders             Int                    @default(20)
  maxStorageGB          Decimal                @default(0.5) @db.Decimal(5, 2)
  currentProducts       Int                    @default(0)
  currentOrders         Int                    @default(0)
  currentStorageGB      Decimal                @default(0) @db.Decimal(5, 2)
  platformFeePercent    Decimal                @default(7.0) @db.Decimal(5, 2)
  trialEndsAt           DateTime?
  logoUrl               String?
  primaryColor          String?                @default("#10b981")
  isActive              Boolean                @default(true)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @default(now())
  subscription_history  subscription_history[]
  User                  User                   @relation(fields: [ownerId], references: [id])
  usage_records         usage_records[]
  vendor_stores         vendor_stores[]

  @@index([customDomain])
  @@index([ownerId])
  @@index([slug])
  @@index([subscriptionStatus])
}

model usage_records {
  id        String   @id
  tenantId  String
  metric    String
  quantity  Int
  timestamp DateTime @default(now())
  tenants   tenants  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, metric, timestamp])
}

model variant_combinations {
  id                String   @id
  productId         String
  combinationKey    String
  optionValues      Json
  sku               String?
  price             Decimal? @db.Decimal(10, 2)
  compareAtPrice    Decimal? @db.Decimal(10, 2)
  quantity          Int      @default(0)
  inventoryTracked  Boolean  @default(true)
  lowStockThreshold Int?
  available         Boolean  @default(true)
  inStock           Boolean  @default(true)
  imageUrl          String?
  sortOrder         Int      @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @default(now())
  products          products @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, combinationKey])
  @@index([productId, available])
  @@index([productId, inStock])
}

model variant_options {
  id          String   @id
  productId   String
  type        String
  value       String
  displayName String
  hexColor    String?
  imageUrl    String?
  icon        String?
  description String?
  sortOrder   Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())
  products    products @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId, isActive])
  @@index([productId, type])
}

model vendor_stores {
  id                        String            @id
  storeId                   String            @unique
  userId                    String
  name                      String
  slug                      String            @unique
  tagline                   String?           @db.VarChar(100)
  description               String?
  logoUrl                   String?
  bannerUrl                 String?
  email                     String
  phone                     String?
  shipFromAddress           Json?
  shippingRates             Json?
  stripeAccountId           String?           @unique
  stripeChargesEnabled      Boolean           @default(false)
  stripeDetailsSubmitted    Boolean           @default(false)
  platformFeePercent        Decimal           @default(7.0) @db.Decimal(5, 2)
  totalProducts             Int               @default(0)
  totalOrders               Int               @default(0)
  totalSales                Decimal           @default(0) @db.Decimal(12, 2)
  averageRating             Decimal?          @db.Decimal(3, 2)
  totalReviews              Int               @default(0)
  isActive                  Boolean           @default(true)
  createdAt                 DateTime          @default(now())
  updatedAt                 DateTime          @default(now())
  primaryPaymentProcessor   PaymentProcessor  @default(STRIPE)
  secondaryPaymentProcessor PaymentProcessor?
  paypalEmail               String?
  paypalMerchantId          String?
  squareAccessToken         String?
  squareLocationId          String?
  acceptsCash               Boolean           @default(false)
  cashInstructions          String?
  tenantId                  String?
  coupons                   coupons[]
  product_reviews           product_reviews[]
  products                  products[]
  shop_ratings              shop_ratings?
  store_orders              store_orders[]
  tenants                   tenants?          @relation(fields: [tenantId], references: [id])
  User                      User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([isActive])
  @@index([slug])
  @@index([tenantId])
  @@index([userId])
}

model writer_profiles {
  id            String   @id
  userId        String   @unique
  displayName   String
  bio           String
  expertise     String[]
  photoUrl      String?
  instagramUrl  String?
  twitterUrl    String?
  websiteUrl    String?
  isApproved    Boolean  @default(false)
  totalArticles Int      @default(0)
  totalViews    Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now())
  User          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

enum ArticleCategory {
  NEWS
  EVENTS
  INTERVIEWS
  HISTORY
  TUTORIALS
  LIFESTYLE
  FASHION
  CULTURE
  COMMUNITY
}

enum ArticleStatus {
  DRAFT
  REVIEW
  APPROVED
  PUBLISHED
  ARCHIVED
}

enum DiscountType {
  PERCENTAGE
  FIXED_AMOUNT
  FREE_SHIPPING
}

enum DomainStatus {
  PENDING
  VERIFYING
  VERIFIED
  FAILED
  ACTIVE
  SUSPENDED
}

enum FulfillmentStatus {
  UNFULFILLED
  PARTIALLY_FULFILLED
  FULFILLED
  SHIPPED
  DELIVERED
}

enum MarketplaceOrderStatus {
  PENDING
  PAID
  CANCELLED
  REFUNDED
}

enum MarketplacePaymentStatus {
  PENDING
  AUTHORIZED
  PAID
  FAILED
  REFUNDED
  PARTIALLY_REFUNDED
}

enum PaymentProcessor {
  STRIPE
  PAYPAL
  SQUARE
  CASH
}

enum ProductCategory {
  ACCESSORIES
  ART_AND_COLLECTIBLES
  BAGS_AND_PURSES
  BATH_AND_BEAUTY
  BOOKS_MOVIES_AND_MUSIC
  CLOTHING
  CRAFT_SUPPLIES_AND_TOOLS
  ELECTRONICS_AND_ACCESSORIES
  HOME_AND_LIVING
  JEWELRY
  PAPER_AND_PARTY_SUPPLIES
  PET_SUPPLIES
  SHOES
  TOYS_AND_GAMES
  WEDDINGS
}

enum ProductStatus {
  DRAFT
  ACTIVE
  OUT_OF_STOCK
  ARCHIVED
}

enum ReviewStatus {
  PUBLISHED
  FLAGGED
  HIDDEN
  DELETED
}

enum SSLStatus {
  PENDING
  REQUESTING
  ACTIVE
  EXPIRED
  FAILED
}

enum SubscriptionPlan {
  TRIAL
  STARTER
  PRO
  ENTERPRISE
}

enum SubscriptionStatus {
  TRIAL
  ACTIVE
  PAST_DUE
  CANCELLED
  PAUSED
}

enum UserRole {
  ADMIN
  USER
  STORE_OWNER
  STORE_ADMIN
  RESTAURANT_OWNER
  EVENT_ORGANIZER
  INSTRUCTOR
  SERVICE_PROVIDER
  MAGAZINE_WRITER
  RESTAURANT_MANAGER
  RESTAURANT_STAFF
  EVENT_STAFF
  AFFILIATE
  MAGAZINE_EDITOR
}

enum VariantType {
  SIZE
  COLOR
}
